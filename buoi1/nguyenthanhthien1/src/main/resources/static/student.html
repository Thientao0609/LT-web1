<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Danh sách sinh viên</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 30px;
        }

        h2 {
            text-transform: uppercase;
        }

        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .btn {
            padding: 8px 12px;
            border: none;
            cursor: pointer;
            border-radius: 4px;
        }

        .btn-add {
            background: #0d6efd;
            color: white;
        }

        .btn-search {
            background: #28a745;
            color: white;
        }

        .btn-clear {
            background: none;
            color: #555;
            text-decoration: underline;
            border: none;
            cursor: pointer;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            border: 1px solid #333;
            padding: 8px;
            text-align: left;
        }

        th {
            background: #f2f2f2;
        }

        .action a {
            margin-right: 10px;
            cursor: pointer;
            text-decoration: none;
            font-weight: bold;
        }

        .edit {
            color: blue;
        }

        .delete {
            color: red;
        }

        .form-box {
            margin-bottom: 20px;
            padding: 10px;
            border: 1px solid #ccc;
            width: 400px;
        }

        .form-box input {
            width: 100%;
            margin-bottom: 8px;
            padding: 6px;
        }
    </style>
</head>
<body>

<h2>DANH SÁCH SINH VIÊN</h2>

<div class="top-bar">
    <button class="btn btn-add" onclick="showForm()">Thêm sinh viên mới</button>

    <div>
        <input type="text" id="keyword" placeholder="Tìm kiếm theo tên...">
        <button class="btn btn-search" onclick="search()">Tìm kiếm</button>
        <button class="btn-clear" onclick="loadStudents()">Xóa lọc</button>
    </div>
</div>

<!-- FORM -->
<div class="form-box" id="form" style="display:none">
    <input type="hidden" id="id">
    <input type="text" id="name" placeholder="Họ tên">
    <input type="number" id="age" placeholder="Tuổi">
    <input type="email" id="email" placeholder="Email">
    <button class="btn btn-add" onclick="saveStudent()">Lưu</button>
</div>

<table>
    <thead>
    <tr>
        <th>ID</th>
        <th>Họ tên</th>
        <th>Tuổi</th>
        <th>Email</th>
        <th>Thao tác</th>
    </tr>
    </thead>
    <tbody id="table"></tbody>
</table>

<script>
    const API = "/api/students";

    function loadStudents(keyword = "") {
        let url = API;
        if (keyword) url += "?keyword=" + keyword;

        fetch(url)
            .then(res => res.json())
            .then(data => {
                let rows = "";
                data.forEach(s => {
                    rows += `
                        <tr>
                            <td>${s.id}</td>
                            <td>${s.name}</td>
                            <td>${s.age ?? ""}</td>
                            <td>${s.email}</td>
                            <td class="action">
                                <a class="edit" onclick="edit(${s.id}, '${s.name}', ${s.age}, '${s.email}')">Sửa</a>
                                <a class="delete" onclick="remove(${s.id})">Xóa</a>
                            </td>
                        </tr>
                    `;
                });
                document.getElementById("table").innerHTML = rows;
            });
    }

    function search() {
        const keyword = document.getElementById("keyword").value;
        loadStudents(keyword);
    }

    function showForm() {
        document.getElementById("form").style.display = "block";
        clearForm();
    }

    function saveStudent() {
        let id = document.getElementById("id").value;
        let student = {
            name: document.getElementById("name").value,
            age: document.getElementById("age").value,
            email: document.getElementById("email").value
        };

        let method = id ? "PUT" : "POST";
        let url = id ? API + "/" + id : API;

        fetch(url, {
            method: method,
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify(student)
        }).then(() => {
            document.getElementById("form").style.display = "none";
            loadStudents();
        });
    }

    function edit(id, name, age, email) {
        document.getElementById("form").style.display = "block";
        document.getElementById("id").value = id;
        document.getElementById("name").value = name;
        document.getElementById("age").value = age;
        document.getElementById("email").value = email;
    }

    function remove(id) {
        if (!confirm("Xóa sinh viên này?")) return;
        fetch(API + "/" + id, { method: "DELETE" })
            .then(() => loadStudents());
    }

    function clearForm() {
        document.getElementById("id").value = "";
        document.getElementById("name").value = "";
        document.getElementById("age").value = "";
        document.getElementById("email").value = "";
    }

    loadStudents();
</script>

</body>
</html>
